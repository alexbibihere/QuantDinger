# HAMA è§†è§‰è¯†åˆ«åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

ä½¿ç”¨å¤§æ¨¡å‹ï¼ˆGPT-4oï¼‰çš„è§†è§‰èƒ½åŠ›è‡ªåŠ¨è¯†åˆ« TradingView å›¾è¡¨ä¸­çš„ HAMA æŒ‡æ ‡æ•°æ®ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½® API å¯†é’¥

åœ¨ `backend_api_python/.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```bash
# OpenRouter API å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
OPENROUTER_API_KEY=sk-or-v1-your-api-key-here

# ä½¿ç”¨çš„æ¨¡å‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤ openai/gpt-4oï¼‰
OPENROUTER_MODEL=openai/gpt-4o
```

æ”¯æŒçš„æ¨¡å‹ï¼š
- `openai/gpt-4o` - æ¨èï¼Œè§†è§‰è¯†åˆ«èƒ½åŠ›æœ€å¼º
- `openai/gpt-4-vision-preview` - å¤‡é€‰
- `anthropic/claude-3.5-sonnet` - å¤‡é€‰

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥

```bash
curl http://localhost:5000/api/hama-vision/health
```

é¢„æœŸè¾“å‡ºï¼š
```json
{
  "success": true,
  "service": "HAMA Vision API",
  "status": "running",
  "api_key_configured": true,
  "model": "openai/gpt-4o"
}
```

### 3. ä½¿ç”¨è§†è§‰è¯†åˆ«æå– HAMA

```bash
curl -X POST http://localhost:5000/api/hama-vision/extract \
  -H "Content-Type: application/json" \
  -d '{
    "chart_url": "https://cn.tradingview.com/chart/U1FY2qxO/",
    "symbol": "ETHUSD",
    "interval": "15"
  }'
```

## ğŸ“Š å“åº”æ ¼å¼

```json
{
  "success": true,
  "data": {
    "hama_value": 3418.03,
    "hama_color": "green",
    "trend": "up",
    "current_price": 3369.1,
    "bollinger_bands": {
      "upper": 3500.0,
      "middle": 3400.0,
      "lower": 3300.0
    },
    "confidence": "high",
    "source": "vision",
    "chart_url": "https://cn.tradingview.com/chart/U1FY2qxO/",
    "symbol": "ETHUSD",
    "interval": "15",
    "screenshot_path": "/tmp/ETHUSD_15_chart.png",
    "note": ""
  }
}
```

## ğŸ”§ Python ä½¿ç”¨ç¤ºä¾‹

```python
import requests

# è°ƒç”¨è§†è§‰è¯†åˆ« API
response = requests.post(
    'http://localhost:5000/api/hama-vision/extract',
    json={
        'chart_url': 'https://cn.tradingview.com/chart/U1FY2qxO/',
        'symbol': 'ETHUSD',
        'interval': '15'
    }
)

result = response.json()

if result['success']:
    data = result['data']

    print(f"HAMA æ•°å€¼: {data['hama_value']}")
    print(f"é¢œè‰²: {data['hama_color']}")
    print(f"è¶‹åŠ¿: {data['trend']}")
    print(f"å½“å‰ä»·æ ¼: {data['current_price']}")
    print(f"ç½®ä¿¡åº¦: {data['confidence']}")

    # æŸ¥çœ‹æˆªå›¾
    print(f"æˆªå›¾è·¯å¾„: {data['screenshot_path']}")
```

## ğŸ¯ å·¥ä½œåŸç†

1. **æˆªå–å›¾è¡¨**
   - ä½¿ç”¨ Playwright è®¿é—® TradingView å›¾è¡¨
   - åº”ç”¨ Stealth æ¨¡å¼ç»•è¿‡åçˆ¬æ£€æµ‹
   - ä½¿ç”¨ Cookie è®¤è¯è®¿é—®ç§æœ‰å›¾è¡¨
   - æˆªå–å›¾è¡¨æˆªå›¾ä¿å­˜åˆ°æœ¬åœ°

2. **è§†è§‰è¯†åˆ«**
   - å°†æˆªå›¾ç¼–ç ä¸º base64
   - å‘é€åˆ° OpenRouter APIï¼ˆä½¿ç”¨ GPT-4oï¼‰
   - ä½¿ç”¨ä¸“é—¨çš„æç¤ºè¯å¼•å¯¼æ¨¡å‹è¯†åˆ« HAMA æ•°æ®
   - è§£ææ¨¡å‹è¿”å›çš„ JSON ç»“æœ

3. **æ•°æ®æ¸…ç†**
   - æå–æ•°å€¼ï¼ˆå»é™¤é€—å·ç­‰æ ¼å¼å­—ç¬¦ï¼‰
   - æ ‡å‡†åŒ–é¢œè‰²ï¼ˆgreen/red/grayï¼‰
   - æ ‡å‡†åŒ–è¶‹åŠ¿ï¼ˆup/down/neutralï¼‰
   - è¿”å›ç»“æ„åŒ–æ•°æ®

## âš–ï¸ ä¼˜ç¼ºç‚¹å¯¹æ¯”

### ä¼˜ç‚¹
- âœ… å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨æå–
- âœ… å¯ä»¥è¯†åˆ«ä»»ä½•å›¾è¡¨å¸ƒå±€
- âœ… æ”¯æŒè‡ªå®šä¹‰ TradingView å›¾è¡¨
- âœ… å¯ä»¥è¯†åˆ«å›¾è¡¨ä¸­çš„æ‰€æœ‰å¯è§æ•°æ®

### ç¼ºç‚¹
- âš ï¸ éœ€è¦ OpenRouter APIï¼ˆæœ‰è´¹ç”¨ï¼‰
- âš ï¸ é€Ÿåº¦è¾ƒæ…¢ï¼ˆ~60ç§’ï¼ŒåŒ…æ‹¬åŠ è½½å’Œè¯†åˆ«ï¼‰
- âš ï¸ ä¾èµ–å›¾è¡¨å¯è®¿é—®æ€§
- âš ï¸ è¯†åˆ«ç²¾åº¦å¯èƒ½ä¸ç¨³å®š

### é€‚ç”¨åœºæ™¯
- ğŸ“Š éœ€è¦ä» TradingView ç§æœ‰å›¾è¡¨æå–æ•°æ®
- ğŸ“Š å›¾è¡¨å¸ƒå±€å¤æ‚ï¼Œæ— æ³•ç”¨å¸¸è§„æ–¹æ³•æå–
- ğŸ“Š éœ€è¦è¯†åˆ«å›¾è¡¨ä¸­çš„å…¶ä»–ä¿¡æ¯
- ğŸ“Š ä¸éœ€è¦é«˜é¢‘è°ƒç”¨ï¼ˆå¶å°”ä½¿ç”¨ï¼‰

## ğŸ’¡ æˆæœ¬ä¼°ç®—

OpenRouter API ä»·æ ¼ï¼ˆ2026å¹´1æœˆï¼‰ï¼š
- GPT-4o: ~$0.0025/å¼ å›¾ç‰‡
- Claude 3.5 Sonnet: ~$0.0015/å¼ å›¾ç‰‡

å‡è®¾æ¯ 15 åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡ï¼š
- æ¯å¤©è°ƒç”¨æ¬¡æ•°ï¼š24 Ã— 4 = 96 æ¬¡
- æ¯å¤©æˆæœ¬ï¼ˆGPT-4oï¼‰ï¼š96 Ã— $0.0025 = $0.24/å¤©
- æ¯æœˆæˆæœ¬ï¼š$0.24 Ã— 30 = $7.2/æœˆ

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿æŠ¤ API å¯†é’¥**
   - ä¸è¦å°† `OPENROUTER_API_KEY` æäº¤åˆ° Git
   - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
   - å®šæœŸè½®æ¢å¯†é’¥

2. **é™åˆ¶ä½¿ç”¨é¢‘ç‡**
   - æ·»åŠ é€Ÿç‡é™åˆ¶
   - ç¼“å­˜è¯†åˆ«ç»“æœ
   - ç›‘æ§ API ä½¿ç”¨é‡

3. **é”™è¯¯å¤„ç†**
   - API è°ƒç”¨å¤±è´¥æ—¶å›é€€åˆ°å…¶ä»–æ–¹æ¡ˆ
   - è®°å½•å¤±è´¥æ—¥å¿—ä¾¿äºæ’æŸ¥
   - è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `app/services/hama_vision_extractor.py` - è§†è§‰è¯†åˆ«æ ¸å¿ƒé€»è¾‘
- `app/routes/hama_vision.py` - API è·¯ç”±
- `tradingview_cookies.json` - TradingView Cookie é…ç½®

## ğŸ†š å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆ

| ç‰¹æ€§ | æœ¬åœ°è®¡ç®— | Playwright æå– | è§†è§‰è¯†åˆ« |
|------|---------|----------------|---------|
| **é€Ÿåº¦** | âš¡ å¿«ï¼ˆ~10msï¼‰ | ğŸ¢ æ…¢ï¼ˆ~50sï¼‰ | ğŸŒ æ…¢ï¼ˆ~60sï¼‰ |
| **æˆæœ¬** | âœ… å…è´¹ | âœ… å…è´¹ | ğŸ’° ä»˜è´¹ |
| **å‡†ç¡®æ€§** | âœ… é«˜ | âš ï¸ ä¸­ç­‰ | âš ï¸ ä¸­ç­‰ |
| **è‡ªåŠ¨åŒ–** | âœ… å®Œå…¨è‡ªåŠ¨åŒ– | âš ï¸ éœ€è¦ç»´æŠ¤é€‰æ‹©å™¨ | âœ… å®Œå…¨è‡ªåŠ¨åŒ– |
| **é€‚ç”¨æ€§** | âœ… ç”Ÿäº§ç¯å¢ƒ | âš ï¸ ç‰¹å®šåœºæ™¯ | âš ï¸ å¤‡ç”¨æ–¹æ¡ˆ |

## ğŸ¯ æ¨èç”¨æ³•

**ä¸»è¦æ–¹æ¡ˆ**ï¼šæœ¬åœ° HAMA è®¡ç®—ï¼ˆæ–¹æ¡ˆ3ï¼‰
- ç”¨äºç”Ÿäº§ç¯å¢ƒå’Œå®æ—¶äº¤æ˜“

**å¤‡ç”¨æ–¹æ¡ˆ**ï¼šPlaywright æå–ï¼ˆæ–¹æ¡ˆ1ï¼‰
- ç”¨äºéªŒè¯æœ¬åœ°è®¡ç®—ç»“æœ
- éœ€è¦ä» TradingView è·å–å…¶ä»–æ•°æ®æ—¶ä½¿ç”¨

**è¾…åŠ©æ–¹æ¡ˆ**ï¼šè§†è§‰è¯†åˆ«ï¼ˆæ–¹æ¡ˆ4ï¼‰â­ NEW
- ç”¨äºè°ƒè¯•å’ŒéªŒè¯
- å¤„ç†ç‰¹æ®Šå›¾è¡¨å¸ƒå±€
- ä¸å®šæœŸä½¿ç”¨æ—¶
