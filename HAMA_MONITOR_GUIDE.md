# 🔔 HAMA信号监控功能使用指南

## 📌 功能概述

HAMA信号监控功能基于您提供的TradingView HAMA蜡烛图指标算法,实现对涨幅榜币种的实时监控。当检测到HAMA蜡烛图与MA线交叉时(涨/跌信号),会自动发出提醒。

---

## 🎯 核心特性

### 1. HAMA指标算法
- **完全基于TradingView指标代码**实现
- **涨信号**: HAMA蜡烛收盘价上穿MA线 (crossover)
- **跌信号**: HAMA蜡烛收盘价下穿MA线 (crossunder)
- 支持多种MA类型: SMA, EMA, WMA

### 2. 自动化监控
- 后台自动运行,每60秒检查一次(可配置)
- 支持监控多个币种
- 智能冷却机制,避免短时间重复报警

### 3. 信号管理
- 实时记录所有信号
- 信号历史查询
- 信号详细信息(币种、价格、时间、描述)

### 4. 灵活配置
- 可调整检查间隔
- 可设置信号冷却时间
- 支持现货/合约市场

---

## 🚀 快速开始

### 步骤1: 部署更新

由于添加了新的功能,需要重新部署服务:

**Windows用户:**
```bash
# 双击运行
一键部署.bat
```

**PowerShell:**
```powershell
cd d:\github\QuantDinger
docker compose down
docker compose build
docker compose up -d
```

### 步骤2: 访问监控页面

部署成功后,访问:
```
http://localhost:8888/hama-monitor
```

### 步骤3: 启动监控

1. 点击 **"启动监控"** 按钮
2. 监控服务开始运行
3. 页面顶部会显示绿色 **"运行中"** 标签

### 步骤4: 添加监控币种

**方法1: 添加涨幅榜**
1. 点击 **"添加涨幅榜"** 按钮
2. 选择市场类型(现货/合约)
3. 设置数量(默认20个)
4. 点击确定

**方法2: 手动添加币种**
1. 点击 **"添加币种"** 按钮
2. 输入币种符号(如 BTCUSDT)
3. 选择市场类型
4. 点击确定

### 步骤5: 查看信号

- 信号会自动显示在 **"信号历史"** 表格中
- 📈 绿色标签表示涨信号
- 📉 红色标签表示跌信号
- 显示价格、时间等详细信息

---

## 📊 页面功能说明

### 统计卡片

页面顶部显示4个统计卡片:

1. **监控币种**: 当前监控的币种数量
2. **信号总数**: 历史信号总数
3. **检查间隔**: 多少秒检查一次(默认60秒)
4. **冷却时间**: 同一币种信号冷却时间(默认300秒)

### 控制按钮

- **启动监控**: 启动监控服务
- **停止监控**: 停止监控服务
- **添加币种**: 手动添加单个币种
- **添加涨幅榜**: 批量添加涨幅榜前N名
- **配置**: 修改监控参数
- **刷新**: 手动刷新数据

### 监控币种列表

显示当前监控的所有币种:
- 币种符号
- 市场类型(现货/合约)
- 最后信号(涨/跌)
- 最后检查时间
- 操作(移除)

### 信号历史表格

显示所有历史信号:
- 币种符号
- 信号类型(涨/跌)
- 价格信息(HAMA值、MA值)
- 时间戳
- 描述

---

## ⚙️ 配置说明

点击 **"配置"** 按钮可以修改:

### 1. 检查间隔
- **默认**: 60秒
- **范围**: 10-3600秒
- **说明**: 系统每隔多少秒检查一次所有币种

**建议设置:**
- 短线交易: 30-60秒
- 中长线: 120-300秒

### 2. 信号冷却时间
- **默认**: 300秒(5分钟)
- **范围**: 0-3600秒
- **说明**: 同一币种产生信号后,多久才能再次产生信号

**建议设置:**
- 避免噪音: 300-600秒
- 敏感监控: 60-120秒

---

## 🔔 信号说明

### 涨信号 (📈)

**触发条件:**
```
HAMA蜡烛收盘价从下方穿越MA线到上方
```

**TradingView代码:**
```pine
hama_cross_up = ta.crossover(CandleClose, ma)
```

**含义:**
- 趋势可能转强
- 可考虑买入
- 适合做多

### 跌信号 (📉)

**触发条件:**
```
HAMA蜡烛收盘价从上方穿越MA线到下方
```

**TradingView代码:**
```pine
hama_cross_down = ta.crossunder(CandleClose, ma)
```

**含义:**
- 趋势可能转弱
- 可考虑卖出
- 适合做空

---

## 🧪 测试功能

### 运行测试脚本

```bash
python test_hama_monitor.py
```

**测试内容:**
1. ✅ 用户登录
2. ✅ 获取监控状态
3. ✅ 启动监控服务
4. ✅ 添加涨幅榜(5个)
5. ✅ 获取监控币种列表
6. ✅ 添加单个币种(BTCUSDT)
7. ✅ 等待信号产生(30秒)
8. ✅ 获取信号历史
9. ✅ 停止监控服务

### API测试

使用curl或Postman测试:

**获取监控状态:**
```bash
curl http://localhost:5000/api/hama-monitor/status \
  -H "Cookie: session=..."
```

**启动监控:**
```bash
curl -X POST http://localhost:5000/api/hama-monitor/start \
  -H "Cookie: session=..."
```

**添加涨幅榜:**
```bash
curl -X POST http://localhost:5000/api/hama-monitor/symbols/add-top-gainers \
  -H "Content-Type: application/json" \
  -H "Cookie: session=..." \
  -d '{"limit": 20, "market": "spot"}'
```

---

## 📈 使用场景

### 场景1: 监控涨幅榜,捕捉趋势变化

**步骤:**
1. 启动监控
2. 点击"添加涨幅榜",选择现货,数量20
3. 等待信号
4. 当某个币种出现涨信号时,考虑买入

**优势:**
- 自动监控最活跃的币种
- 及时捕捉趋势反转
- 避免人工盯盘

### 场景2: 监控特定币种

**步骤:**
1. 启动监控
2. 手动添加感兴趣的币种(如 BTC, ETH)
3. 设置较短的检查间隔(30秒)
4. 收到信号后及时操作

**优势:**
- 专注重点币种
- 快速响应市场变化

### 场景3: 长期趋势监控

**步骤:**
1. 启动监控
2. 添加币种
3. 设置较长的检查间隔(300秒)
4. 设置较长的冷却时间(600秒)
5. 只关注主要趋势变化

**优势:**
- 过滤短期波动
- 捕捉主要趋势
- 减少噪音干扰

---

## ⚠️ 注意事项

### 1. 信号延迟
- K线数据有1小时延迟(使用1小时K线)
- 网络请求可能有延迟
- 建议不要过度依赖短期信号

### 2. 信号准确性
- HAMA指标是基于历史价格计算
- 不能保证100%准确
- 建议结合其他指标综合判断

### 3. 风险控制
- 信号仅供参考,不构成投资建议
- 请做好风险管理
- 建议设置止损止盈

### 4. 系统资源
- 监控币种过多可能影响性能
- 建议监控20-50个币种
- 检查间隔不宜过短

---

## 🐛 常见问题

### Q1: 为什么一直没有信号?

**A:** HAMA信号需要满足交叉条件,可能需要等待较长时间。这是正常现象。

**建议:**
- 增加监控币种数量
- 降低检查间隔
- 耐心等待市场变化

### Q2: 信号可以推送手机吗?

**A:** 当前版本支持前端页面展示。可以通过以下方式获取通知:
- 保持前端页面打开
- 定期刷新页面查看
- 后续版本可以添加Telegram/邮件推送

### Q3: 如何调整HAMA参数?

**A:** 当前版本使用TradingView默认参数:
- MA长度: 55
- MA类型: WMA
- 开盘价: EMA 25
- 最高价: EMA 20
- 最低价: EMA 20
- 收盘价: WMA 20

如需修改,可以编辑:
```
backend_api_python/app/services/hama_monitor.py
```

### Q4: 监控会影响交易吗?

**A:** 不会。监控服务是只读的,只是获取市场数据和计算指标,不会执行任何交易操作。

### Q5: 能监控合约市场吗?

**A:** 可以!添加币种时选择"合约"即可。但请注意合约风险较高。

---

## 📞 技术支持

### 查看日志

```bash
# 查看后端日志
docker compose logs -f backend

# 查看监控相关日志
docker compose logs backend | grep HAMA
```

### 重启监控

如果监控出现异常:

1. 在前端点击"停止监控"
2. 等待几秒
3. 再次点击"启动监控"

### 完全重启

```bash
docker compose restart backend
```

---

## 🎉 总结

HAMA信号监控功能为您提供:
- ✅ 自动化市场监控
- ✅ 基于TradingView算法的准确信号
- ✅ 灵活的配置选项
- ✅ 完整的信号历史
- ✅ 友好的用户界面

**开始使用:**
1. 运行 `一键部署.bat`
2. 访问 http://localhost:8888/hama-monitor
3. 启动监控,添加币种
4. 等待信号,把握机会!

---

**祝您交易顺利! 📈**
