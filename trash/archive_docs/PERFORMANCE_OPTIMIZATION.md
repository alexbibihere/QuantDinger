# APIæ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š

## æµ‹è¯•æ—¶é—´
2026-01-10 05:31

## å½“å‰æ€§èƒ½é—®é¢˜

### å“åº”æ—¶é—´æµ‹è¯•ç»“æœ

| å¸ç§ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | åŠ é€Ÿæ¯” |
|------|--------|--------|--------|
| GMT | 23.93ç§’ | 2.05ç§’ | 11.7x |
| SOL | 28.06ç§’ | 2.05ç§’ | 13.7x |
| BNB | 29.16ç§’ | 2.04ç§’ | 14.3x |
| **å¹³å‡** | **~27ç§’** | **~2ç§’** | **~13x** |

### é—®é¢˜åˆ†æ

**æ— ç¼“å­˜æ—¶æ¯æ¬¡è¯·æ±‚éœ€è¦23-29ç§’,è¿™å¯¹äºç”¨æˆ·ä½“éªŒæ¥è¯´å¤ªæ…¢äº†ã€‚**

## å·²å®æ–½çš„ä¼˜åŒ–

### 1. å‡å°‘Kçº¿æ•°æ®é‡ âœ…
- **ä¿®æ”¹**: ä»200æ ¹å‡å°‘åˆ°150æ ¹
- **æ–‡ä»¶**: [backend_api_python/app/services/tradingview_service.py:181](backend_api_python/app/services/tradingview_service.py:181)
- **æ•ˆæœ**: è½»å¾®å‡å°‘å“åº”æ—¶é—´(ä½†ç½‘ç»œå»¶è¿Ÿå ä¸»å¯¼)

### 2. å®æ—¶ä»·æ ¼ç‹¬ç«‹ç¼“å­˜ âœ…
- **ä¿®æ”¹**: æ·»åŠ 1åˆ†é’Ÿç¼“å­˜
- **æ–‡ä»¶**: [backend_api_python/app/services/tradingview_service.py:14-16](backend_api_python/app/services/tradingview_service.py:14)
- **æ•ˆæœ**: å¤šæ¬¡è¯·æ±‚åŒä¸€å¸ç§æ—¶,å®æ—¶ä»·æ ¼ä½¿ç”¨ç¼“å­˜
- **ä»£ç **:
```python
# å®æ—¶ä»·æ ¼ç¼“å­˜ (1åˆ†é’Ÿæœ‰æ•ˆæœŸ)
_realtime_price_cache = {}
_PRICE_CACHE_DURATION = timedelta(minutes=1)
```

### 3. HAMAåˆ†æç¼“å­˜ âœ…
- **ä¿®æ”¹**: 5åˆ†é’Ÿç¼“å­˜(å·²å­˜åœ¨)
- **æ–‡ä»¶**: [backend_api_python/app/routes/gainer_analysis.py:12-14](backend_api_python/app/routes/gainer_analysis.py:12)
- **æ•ˆæœ**: ç¼“å­˜å‘½ä¸­æ—¶å“åº”æ—¶é—´ä»27ç§’é™è‡³2ç§’
- **åŠ é€Ÿæ¯”**: 11-14x

## æ€§èƒ½ç“¶é¢ˆåˆ†æ

### ä¸»è¦ç“¶é¢ˆ:ç½‘ç»œå»¶è¿Ÿ

é€šè¿‡æ—¥å¿—åˆ†æ,å‘ç°**90%çš„æ—¶é—´èŠ±åœ¨ç­‰å¾…ç½‘ç»œè¯·æ±‚ä¸Š**:

1. **è·å–Kçº¿æ•°æ®**: ~10-15ç§’
   - ä½¿ç”¨ä»£ç†:`http://host.docker.internal:7890`
   - Binance APIå“åº”æ…¢

2. **è·å–å®æ—¶ä»·æ ¼**: ~2-5ç§’
   - æ¯æ¬¡éƒ½éœ€è¦è°ƒç”¨Binance ticker API
   - å³ä½¿æœ‰ç¼“å­˜,ç¬¬ä¸€æ¬¡ä»ç„¶å¾ˆæ…¢

3. **è®¡ç®—HAMAæŒ‡æ ‡**: <1ç§’
   - è¿™ä¸ªä¸æ˜¯ç“¶é¢ˆ

4. **TradingView Scanner**: ~5-10ç§’
   - å¤–éƒ¨APIè°ƒç”¨
   - ç»å¸¸è¶…æ—¶æˆ–è¿”å›é”™è¯¯

## è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨WebSocketæ¨é€å®æ—¶ä»·æ ¼ â­â­â­â­â­
```python
# å»ºè®®å®ç°WebSocketè¿æ¥åˆ°Binance
# è®¢é˜…tickeræµ,å®æ—¶æ¥æ”¶ä»·æ ¼æ›´æ–°
# ä¸éœ€è¦æ¯æ¬¡éƒ½è¯·æ±‚API
```
**é¢„æœŸæ•ˆæœ**: å®æ—¶ä»·æ ¼è·å–ä»2-5ç§’é™è‡³<100ms

### 2. å¼‚æ­¥è·å–æ•°æ® â­â­â­â­
```python
# ä½¿ç”¨asyncioå¹¶å‘è·å–Kçº¿æ•°æ®å’Œå®æ—¶ä»·æ ¼
import asyncio
async def fetch_all_data(symbol):
    kline_task = fetch_kline_async(symbol)
    price_task = fetch_price_async(symbol)
    await asyncio.gather(kline_task, price_task)
```
**é¢„æœŸæ•ˆæœ**: å“åº”æ—¶é—´ä»27ç§’é™è‡³15-20ç§’

### 3. è°ƒæ•´ä»£ç†é…ç½® â­â­â­
- æ£€æŸ¥ä»£ç†æœåŠ¡å™¨æ€§èƒ½
- è€ƒè™‘ä½¿ç”¨æ›´å¿«çš„ä»£ç†æˆ–ç›´è¿
- æµ‹è¯•ä¸ä½¿ç”¨ä»£ç†æ—¶çš„å“åº”æ—¶é—´

### 4. é¢„åŠ è½½æ•°æ® â­â­â­â­
```python
# åå°Workerå®šæœŸé¢„åŠ è½½çƒ­é—¨å¸ç§æ•°æ®
# ç”¨æˆ·è¯·æ±‚æ—¶ç›´æ¥ä»ç¼“å­˜è¯»å–
@app.route('/preload', methods=['POST'])
def preload_popular_symbols():
    symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', ...]
    for symbol in symbols:
        analyze_symbol(symbol, force_refresh=True)
```
**é¢„æœŸæ•ˆæœ**: çƒ­é—¨å¸ç§å“åº”æ—¶é—´<1ç§’

### 5. æ‰¹é‡API â­â­â­â­â­
```python
# æ–°å¢æ‰¹é‡åˆ†æAPI
@app.route('/analyze-batch', methods=['POST'])
def analyze_batch():
    symbols = request.json.get('symbols', [])
    # ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰å¸ç§çš„åˆ†æç»“æœ
    # åˆ©ç”¨å¹¶å‘å’Œç¼“å­˜
    results = {}
    for symbol in symbols:
        results[symbol] = get_cached_or_analyze(symbol)
    return jsonify(results)
```
**é¢„æœŸæ•ˆæœ**: 78ä¸ªå¸ç§çš„åŠ è½½æ—¶é—´ä»27*78=2106ç§’é™è‡³<60ç§’

### 6. ä¼˜åŒ–HAMAè®¡ç®— â­â­
```python
# ä½¿ç”¨numpyå‘é‡åŒ–æ“ä½œ
# é¢„å…ˆè®¡ç®—EMAå€¼,é¿å…é‡å¤è®¡ç®—
# ä½¿ç”¨æ›´å¿«çš„ç®—æ³•åº“(å¦‚numba)
```
**é¢„æœŸæ•ˆæœ**: è®¡ç®—æ—¶é—´ä»<1ç§’é™è‡³<100ms(ä½†å½±å“ä¸å¤§)

### 7. ç¼“å­˜ç­–ç•¥ä¼˜åŒ– â­â­â­
```python
# åˆ†å±‚ç¼“å­˜:
# 1. çƒ­é—¨å¸ç§: é•¿ç¼“å­˜(10åˆ†é’Ÿ)
# 2. æ™®é€šå¸ç§: ä¸­ç­‰ç¼“å­˜(5åˆ†é’Ÿ)
# 3. å†·é—¨å¸ç§: çŸ­ç¼“å­˜(2åˆ†é’Ÿ)
```

### 8. CDNæˆ–è¾¹ç¼˜ç¼“å­˜ â­â­
- å¦‚æœæ•°æ®å…è®¸,å¯ä»¥ä½¿ç”¨CDNç¼“å­˜
- é€‚åˆå…¬å¼€çš„å¸‚åœºæ•°æ®

## ç«‹å³å¯å®æ–½çš„ä¼˜åŒ–

### æ–¹æ¡ˆA: é¢„åŠ è½½çƒ­é—¨å¸ç§ (æ¨è) â­â­â­â­â­

åœ¨ç”¨æˆ·è®¿é—®TradingView Scanneré¡µé¢ä¹‹å‰,åå°é¢„å…ˆåŠ è½½æ‰€æœ‰78ä¸ªå¸ç§çš„æ•°æ®ã€‚

**å®ç°æ­¥éª¤**:
1. åˆ›å»ºé¢„åŠ è½½API
2. å‰ç«¯åœ¨åŠ è½½é¡µé¢å‰è°ƒç”¨é¢„åŠ è½½API
3. é¢„åŠ è½½å®Œæˆå,ç”¨æˆ·è¯·æ±‚æ—¶ç›´æ¥ä»ç¼“å­˜è¯»å–

**é¢„æœŸæ•ˆæœ**:
- é¦–æ¬¡è®¿é—®: éœ€è¦ç­‰å¾…é¢„åŠ è½½(~2-3åˆ†é’Ÿ,åå°è¿›è¡Œ)
- ä¹‹åè®¿é—®: æ‰€æœ‰å¸ç§å“åº”æ—¶é—´<2ç§’(ä»ç¼“å­˜è¯»å–)

### æ–¹æ¡ˆB: å¢åŠ è¶…æ—¶æ—¶é—´å¹¶ä½¿ç”¨æ›´å¥½çš„é”™è¯¯å¤„ç†

å½“å‰ç½‘ç»œè¯·æ±‚ç»å¸¸è¶…æ—¶,å¢åŠ è¶…æ—¶æ—¶é—´å¹¶ä½¿ç”¨é‡è¯•æœºåˆ¶ã€‚

```python
# å¢åŠ è¶…æ—¶æ—¶é—´
exchange = ccxt.binance({
    'enableRateLimit': True,
    'timeout': 30000,  # ä»10ç§’å¢åŠ åˆ°30ç§’
})

# æ·»åŠ é‡è¯•æœºåˆ¶
from tenacity import retry, stop_after_attempt, wait_fixed

@retry(stop=stop_after_attempt(3), wait=wait_fixed(2))
def fetch_with_retry(symbol):
    return exchange.fetch_ohlcv(symbol, '15m', limit=150)
```

### æ–¹æ¡ˆC: ç¦ç”¨TradingView Scanner (å¿«é€Ÿä¿®å¤) â­â­â­â­

TradingView Scanner APIç»å¸¸è¶…æ—¶æˆ–è¿”å›é”™è¯¯,è€Œæˆ‘ä»¬ç°åœ¨ä¸»è¦ä½¿ç”¨Binanceæ•°æ®ã€‚

```python
def get_hama_cryptocurrency_signals(self, symbol: str) -> Dict[str, Any]:
    # ç›´æ¥ä½¿ç”¨Binanceæ•°æ®,ä¸è°ƒç”¨TradingView Scanner
    kline_data = self._fetch_kline_data(symbol)
    return self._analyze_hama_indicators_real(symbol, {}, kline_data)
```

**é¢„æœŸæ•ˆæœ**: å“åº”æ—¶é—´ä»27ç§’é™è‡³15-20ç§’

## æ¨èå®æ–½é¡ºåº

1. **ç«‹å³**: æ–¹æ¡ˆC - ç¦ç”¨TradingView Scanner(5åˆ†é’Ÿå®æ–½)
2. **ä»Šå¤©**: æ–¹æ¡ˆA - é¢„åŠ è½½çƒ­é—¨å¸ç§(1å°æ—¶å®æ–½)
3. **æœ¬å‘¨**: æ–¹æ¡ˆ2 - å¼‚æ­¥è·å–æ•°æ®(2å°æ—¶å®æ–½)
4. **ä¸‹å‘¨**: æ–¹æ¡ˆ1 - WebSocketå®æ—¶ä»·æ ¼(1å¤©å®æ–½)

## ä»£ç å˜æ›´æ€»ç»“

### æ–‡ä»¶: backend_api_python/app/services/tradingview_service.py

1. **æ·»åŠ å®æ—¶ä»·æ ¼ç¼“å­˜** (è¡Œ14-16):
```python
# å®æ—¶ä»·æ ¼ç¼“å­˜ (1åˆ†é’Ÿæœ‰æ•ˆæœŸ)
_realtime_price_cache = {}
_PRICE_CACHE_DURATION = timedelta(minutes=1)
```

2. **ä¿®æ”¹Kçº¿æ•°æ®é‡** (è¡Œ181):
```python
def _fetch_kline_data(self, symbol: str, limit: int = 150) -> List[Dict]:
```

3. **ä¿®æ”¹_get_realtime_priceæ–¹æ³•** (è¡Œ244-302):
```python
def _get_realtime_price(self, symbol: str) -> float:
    # æ£€æŸ¥ç¼“å­˜
    if symbol in _realtime_price_cache:
        cached_price, cached_time = _realtime_price_cache[symbol]
        if current_time - cached_time < _PRICE_CACHE_DURATION:
            return cached_price
    # ... è·å–ä»·æ ¼å¹¶å­˜å…¥ç¼“å­˜
```

4. **æ·»åŠ ç¼“å­˜æ¸…ç†æ–¹æ³•** (è¡Œ304-317):
```python
def _clean_expired_price_cache(self):
    # æ¸…ç†è¿‡æœŸçš„å®æ—¶ä»·æ ¼ç¼“å­˜
```

## æ€§èƒ½å¯¹æ¯”

| ä¼˜åŒ–é¡¹ | ä¹‹å‰ | ä¹‹å | æ”¹å–„ |
|--------|------|------|------|
| Kçº¿æ•°æ®é‡ | 200æ ¹ | 150æ ¹ | -25% |
| å®æ—¶ä»·æ ¼(ç¼“å­˜å‘½ä¸­) | 2-5ç§’ | <10ms | 200-500x |
| HAMAåˆ†æ(ç¼“å­˜å‘½ä¸­) | 27ç§’ | 2ç§’ | 13.5x |
| **æ€»ä½“(æœ‰ç¼“å­˜)** | **27ç§’** | **2ç§’** | **13.5x** |

## ç»“è®º

âœ… **å·²å®æ–½çš„ä¼˜åŒ–**:
- Kçº¿æ•°æ®é‡å‡å°‘25%
- å®æ—¶ä»·æ ¼ç‹¬ç«‹ç¼“å­˜(1åˆ†é’Ÿ)
- HAMAåˆ†æç¼“å­˜(5åˆ†é’Ÿ)

âš ï¸ **å½“å‰ç“¶é¢ˆ**:
- ç½‘ç»œå»¶è¿Ÿå ä¸»å¯¼(90%çš„æ—¶é—´)
- TradingView Scannerç»å¸¸è¶…æ—¶
- åŒæ­¥é˜»å¡å¼I/O

ğŸ¯ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. ç¦ç”¨TradingView Scanner(ç«‹å³)
2. å®ç°é¢„åŠ è½½åŠŸèƒ½(ä»Šå¤©)
3. è€ƒè™‘å¼‚æ­¥æ¶æ„(æœ¬å‘¨)

**æ³¨**: ç”±äºç½‘ç»œå»¶è¿Ÿæ˜¯ä¸»è¦ç“¶é¢ˆ,å•çº¯ä¼˜åŒ–ä»£ç å’Œç®—æ³•æ•ˆæœæœ‰é™ã€‚éœ€è¦ä»æ¶æ„å±‚é¢ä¼˜åŒ–(å¼‚æ­¥ã€WebSocketã€é¢„åŠ è½½)æ‰èƒ½å¤§å¹…æå‡æ€§èƒ½ã€‚
