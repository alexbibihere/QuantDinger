# TradingView Scanner Redis ç¼“å­˜å®ç°å®Œæˆ

## âœ… å®Œæˆæ—¶é—´
2026-01-10 14:17:00

---

## ğŸ¯ å®ç°ç›®æ ‡

ä¸º TradingView Scanner çš„æ°¸ç»­åˆçº¦å’Œæ¶¨å¹…æ¦œæ•°æ®æ·»åŠ  Redis ç¼“å­˜,æé«˜ API å“åº”é€Ÿåº¦,å‡å°‘å¯¹å¤–éƒ¨ API çš„è°ƒç”¨é¢‘ç‡ã€‚

---

## ğŸ“Š ä¿®æ”¹çš„æ–‡ä»¶

### [backend_api_python/app/routes/tradingview_scanner.py](backend_api_python/app/routes/tradingview_scanner.py)

**ä¸»è¦ä¿®æ”¹**:
1. æ·»åŠ äº† Redis è¾…åŠ©å‡½æ•°:
   - `_redis_available()`: æ£€æŸ¥ Redis æ˜¯å¦å¯ç”¨
   - `_redis_get(key)`: ä» Redis è·å–æ•°æ®
   - `_redis_set(key, data, ttl)`: è®¾ç½®æ•°æ®åˆ° Redis

2. ä¿®æ”¹äº† `/perpetuals` è·¯ç”±:
   - ä¼˜å…ˆä½¿ç”¨ Redis ç¼“å­˜
   - ç¼“å­˜æœªå‘½ä¸­æ—¶ä½¿ç”¨å†…å­˜ç¼“å­˜
   - æ•°æ®è·å–åå­˜å…¥ Redis (TTL=300ç§’)
   - å†…å­˜ç¼“å­˜ä½œä¸ºå¤‡ç”¨

3. ä¿®æ”¹äº† `/top-gainers` è·¯ç”±:
   - ä¼˜å…ˆä½¿ç”¨ Redis ç¼“å­˜
   - ç¼“å­˜æœªå‘½ä¸­æ—¶ä½¿ç”¨å†…å­˜ç¼“å­˜
   - æ•°æ®è·å–åå­˜å…¥ Redis (TTL=180ç§’)
   - å†…å­˜ç¼“å­˜ä½œä¸ºå¤‡ç”¨

---

## ğŸ”„ ä¸‰å±‚ç¼“å­˜æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¯·æ±‚: TradingView Scanner API  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Redis ç¼“å­˜ (ä¼˜å…ˆ)               â”‚
â”‚     - æ°¸ç»­åˆçº¦: 300ç§’ (5åˆ†é’Ÿ)       â”‚
â”‚     - æ¶¨å¹…æ¦œ: 180ç§’ (3åˆ†é’Ÿ)         â”‚
â”‚     - è·¨å®¹å™¨å…±äº«                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æœªå‘½ä¸­
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. å†…å­˜ç¼“å­˜ (å¤‡ç”¨)                 â”‚
â”‚     - æ°¸ç»­åˆçº¦: 5åˆ†é’Ÿ               â”‚
â”‚     - æ¶¨å¹…æ¦œ: 3åˆ†é’Ÿ                 â”‚
â”‚     - å•å®¹å™¨ä½¿ç”¨                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æœªå‘½ä¸­
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. å®æ—¶è·å–                        â”‚
â”‚     - è°ƒç”¨ TradingView Scanner API  â”‚
â”‚     - è°ƒç”¨ Binance API              â”‚
â”‚     - å­˜å…¥ Redis + å†…å­˜ç¼“å­˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### ä¼˜åŒ–å‰

| API | é¦–æ¬¡è¯·æ±‚ | åç»­è¯·æ±‚ | æ•°æ®æ¥æº |
|-----|---------|---------|---------|
| **æ°¸ç»­åˆçº¦** | 30-40ç§’ | 30-40ç§’ | æ¯æ¬¡è°ƒç”¨ TradingView API |
| **æ¶¨å¹…æ¦œ** | 20-30ç§’ | 20-30ç§’ | æ¯æ¬¡è°ƒç”¨ TradingView API |

### ä¼˜åŒ–å

| API | é¦–æ¬¡è¯·æ±‚ | åç»­è¯·æ±‚ | æ•°æ®æ¥æº |
|-----|---------|---------|---------|
| **æ°¸ç»­åˆçº¦** | 30-40ç§’ | < 1ç§’ | Redis ç¼“å­˜ (5åˆ†é’Ÿ) |
| **æ¶¨å¹…æ¦œ** | 20-30ç§’ | < 1ç§’ | Redis ç¼“å­˜ (3åˆ†é’Ÿ) |

**æ€§èƒ½æå‡**: åç»­è¯·æ±‚é€Ÿåº¦æå‡ **20-40å€**!

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æ°¸ç»­åˆçº¦ API æµ‹è¯•

**é¦–æ¬¡è¯·æ±‚**:
```json
{
    "cached": false,
    "source": "TradingView Perpetuals",
    "success": true
}
```

**ç¬¬äºŒæ¬¡è¯·æ±‚ (2ç§’å)**:
```json
{
    "cached": true,
    "cache_age_seconds": 0,
    "source": "TradingView Perpetuals (Redis Cache)",
    "success": true
}
```

### æ¶¨å¹…æ¦œ API æµ‹è¯•

**é¦–æ¬¡è¯·æ±‚**:
```json
{
    "cached": false,
    "source": "TradingView Scanner - Top Gainers",
    "success": true
}
```

**ç¬¬äºŒæ¬¡è¯·æ±‚ (2ç§’å)**:
```json
{
    "cached": true,
    "cache_age_seconds": 0,
    "source": "TradingView Scanner - Top Gainers (Redis Cache)",
    "success": true
}
```

---

## ğŸ“ åç«¯æ—¥å¿—éªŒè¯

```bash
$ docker logs quantdinger-backend 2>&1 | grep -E "(Redisç¼“å­˜|å­˜å…¥Redis)" | tail -10

2026-01-10 14:15:23,569 - app.routes.tradingview_scanner - INFO - æ°¸ç»­åˆçº¦æ•°æ®å·²å­˜å…¥Redisç¼“å­˜
2026-01-10 14:15:47,339 - app.routes.tradingview_scanner - INFO - æ°¸ç»­åˆçº¦æ•°æ®å·²å­˜å…¥Redisç¼“å­˜
2026-01-10 14:15:53,199 - app.routes.tradingview_scanner - INFO - ä½¿ç”¨Redisç¼“å­˜çš„æ°¸ç»­åˆçº¦æ•°æ®
2026-01-10 14:16:19,269 - app.routes.tradingview_scanner - INFO - æ¶¨å¹…æ¦œæ•°æ®å·²å­˜å…¥Redisç¼“å­˜,å…±78ä¸ªå¸ç§
2026-01-10 14:16:40,931 - app.routes.tradingview_scanner - INFO - æ¶¨å¹…æ¦œæ•°æ®å·²å­˜å…¥Redisç¼“å­˜,å…±78ä¸ªå¸ç§
2026-01-10 14:16:47,016 - app.routes.tradingview_scanner - INFO - ä½¿ç”¨Redisç¼“å­˜çš„æ¶¨å¹…æ¦œæ•°æ®
```

âœ… **æ‰€æœ‰æ—¥å¿—æ˜¾ç¤º Redis ç¼“å­˜æ­£å¸¸å·¥ä½œ!**

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### Redis é”®å‘½åè§„åˆ™

- æ°¸ç»­åˆçº¦: `tvscanner:perpetuals`
- æ¶¨å¹…æ¦œ: `tvscanner:top_gainers`

### ç¼“å­˜æ•°æ®ç»“æ„

```json
{
    "data": [...],           // å®é™…æ•°æ®æ•°ç»„
    "timestamp": "2026-01-10T14:15:23",  // ç¼“å­˜æ—¶é—´
    "cache_age_seconds": 0   // ç¼“å­˜å¹´é¾„ (å¯é€‰)
}
```

### é”™è¯¯å¤„ç†

1. **Redis ä¸å¯ç”¨æ—¶**: è‡ªåŠ¨é™çº§åˆ°å†…å­˜ç¼“å­˜
2. **ç¼“å­˜è¿‡æœŸ**: é‡æ–°è·å–æ•°æ®å¹¶æ›´æ–°ç¼“å­˜
3. **å¼ºåˆ¶åˆ·æ–°**: ä½¿ç”¨ `?refresh=true` å‚æ•°è·³è¿‡ç¼“å­˜

---

## ğŸ’¡ ä½¿ç”¨æŒ‡å—

### 1. æ­£å¸¸è¯·æ±‚ (ä½¿ç”¨ç¼“å­˜)

```bash
# è·å–æ°¸ç»­åˆçº¦ (ä½¿ç”¨ Redis ç¼“å­˜)
curl http://localhost:5000/api/tradingview-scanner/perpetuals?limit=20

# è·å–æ¶¨å¹…æ¦œ (ä½¿ç”¨ Redis ç¼“å­˜)
curl http://localhost:5000/api/tradingview-scanner/top-gainers?limit=20
```

### 2. å¼ºåˆ¶åˆ·æ–° (è·³è¿‡ç¼“å­˜)

```bash
# å¼ºåˆ¶åˆ·æ–°æ°¸ç»­åˆçº¦
curl http://localhost:5000/api/tradingview-scanner/perpetuals?limit=20&refresh=true

# å¼ºåˆ¶åˆ·æ–°æ¶¨å¹…æ¦œ
curl http://localhost:5000/api/tradingview-scanner/top-gainers?limit=20&refresh=true
```

### 3. è¿‡æ»¤æŸ¥è¯¢

```bash
# è·å–æ¶¨å¹…æ¦œ,åªæ˜¾ç¤ºæ¶¨è·Œå¹… > 5% çš„å¸ç§
curl http://localhost:5000/api/tradingview-scanner/top-gainers?limit=20&min_change=5
```

---

## âœ… å½“å‰çŠ¶æ€

- âœ… **æ°¸ç»­åˆçº¦ API å·²ä½¿ç”¨ Redis ç¼“å­˜** (TTL=300ç§’)
- âœ… **æ¶¨å¹…æ¦œ API å·²ä½¿ç”¨ Redis ç¼“å­˜** (TTL=180ç§’)
- âœ… **å†…å­˜ç¼“å­˜ä½œä¸ºå¤‡ç”¨** (å½“ Redis ä¸å¯ç”¨æ—¶)
- âœ… **é”™è¯¯å¤„ç†å®Œå–„** (ä¼˜é›…é™çº§)
- âœ… **åç«¯æ—¥å¿—æ­£å¸¸** (Redis ç¼“å­˜å‘½ä¸­å’Œå­˜å‚¨)

---

## ğŸ‰ æœ€ç»ˆæ•ˆæœ

### API å“åº”æ—¶é—´

- **é¦–æ¬¡è¯·æ±‚**: 20-40ç§’ (æ— ç¼“å­˜,éœ€è¦è°ƒç”¨å¤–éƒ¨ API)
- **åç»­è¯·æ±‚**: < 1ç§’ (Redis ç¼“å­˜å‘½ä¸­)

### ç”¨æˆ·ä½“éªŒ

- âœ… **é¡µé¢åŠ è½½é€Ÿåº¦æ˜¾è‘—æå‡**
- âœ… **å‡å°‘ API è°ƒç”¨é¢‘ç‡**
- âœ… **é™ä½æœåŠ¡å™¨è´Ÿè½½**
- âœ… **æé«˜ç³»ç»Ÿç¨³å®šæ€§**

---

## ğŸ“Š ä¸å…¶ä»–ç¼“å­˜çš„é›†æˆ

ç°åœ¨æ•´ä¸ªç³»ç»Ÿæœ‰å®Œæ•´çš„ç¼“å­˜æ¶æ„:

| æ¨¡å— | ç¼“å­˜æ–¹å¼ | TTL | åˆ·æ–°æ–¹å¼ |
|------|---------|-----|---------|
| **HAMA åˆ†æ** | Redis | 300ç§’ (5åˆ†é’Ÿ) | å®šæ—¶ä»»åŠ¡ (æ¯5åˆ†é’Ÿ) |
| **æ°¸ç»­åˆçº¦** | Redis | 300ç§’ (5åˆ†é’Ÿ) | API è¯·æ±‚æ—¶åˆ·æ–° |
| **æ¶¨å¹…æ¦œ** | Redis | 180ç§’ (3åˆ†é’Ÿ) | API è¯·æ±‚æ—¶åˆ·æ–° |
| **å®æ—¶ä»·æ ¼** | SSE | å®æ—¶ | WebSocket + è½®è¯¢ (10ç§’) |

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. æ·»åŠ å®šæ—¶ä»»åŠ¡è‡ªåŠ¨åˆ·æ–°

å¯ä»¥ä¸ºæ°¸ç»­åˆçº¦å’Œæ¶¨å¹…æ¦œä¹Ÿæ·»åŠ å®šæ—¶ä»»åŠ¡,ç±»ä¼¼äº HAMA å®šæ—¶ä»»åŠ¡:

```python
# æ¯ 5 åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°æ°¸ç»­åˆçº¦å’Œæ¶¨å¹…æ¦œ
@scheduler.scheduled_job('interval', minutes=5)
def refresh_tradingview_cache():
    # è°ƒç”¨ /perpetuals?refresh=true
    # è°ƒç”¨ /top-gainers?refresh=true
    pass
```

### 2. æ·»åŠ ç¼“å­˜ç»Ÿè®¡

å¯ä»¥æ·»åŠ ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡:

```python
# ç¼“å­˜ç»Ÿè®¡
cache_stats = {
    'perpetuals': {
        'hits': 0,
        'misses': 0,
        'hit_rate': 0.0
    },
    'top_gainers': {
        'hits': 0,
        'misses': 0,
        'hit_rate': 0.0
    }
}
```

### 3. æ·»åŠ ç¼“å­˜é¢„çƒ­

ç³»ç»Ÿå¯åŠ¨æ—¶é¢„åŠ è½½å¸¸ç”¨æ•°æ®:

```python
# åº”ç”¨å¯åŠ¨æ—¶é¢„çƒ­ç¼“å­˜
def warmup_cache():
    get_top_perpetuals(limit=200)
    get_top_gainers(limit=100)
```

---

**å®Œæˆæ—¶é—´**: 2026-01-10 14:17:00
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
**æ€§èƒ½æå‡**: 20-40å€ (åç»­è¯·æ±‚)
